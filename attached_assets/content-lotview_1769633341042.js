"use strict";(()=>{var p="LV_EXTRACT_IMAGES";function f(t){return new Promise(n=>setTimeout(n,t))}async function y(){let t=[".photo-gallery__thumbnail",".gallery-thumbnail",".thumbnail-item",".vehicle-thumbnail","[data-thumbnail]",".swiper-slide-thumb-active",".slick-dots li",".carousel-indicators li"];for(let n of t){let r=document.querySelectorAll(n);if(r.length>0){for(let e of r)try{e.click(),await f(200)}catch{}break}}}async function b(){let t=[".photo-gallery",".vehicle-gallery",".swiper-container",".carousel"];for(let n of t){let r=document.querySelector(n);if(r){let e=r.querySelector(".swiper-wrapper")||r;e instanceof HTMLElement&&(e.scrollLeft=e.scrollWidth,await f(300),e.scrollLeft=0);break}}}function w(){let t=[],n=new Set,r=["logo","icon","badge","banner","promo","button","arrow","chevron","social","facebook","twitter","placeholder","no-image","coming-soon","spinner","loading","1x1","tracking"],e=s=>{if(!s||s.length<30||s.startsWith("data:")||s.startsWith("blob:"))return!1;let o=s.toLowerCase();for(let i of r)if(o.includes(i))return!1;return!(!/\.(jpg|jpeg|png|webp|avif)/i.test(o)&&!o.includes("cloudinary")&&!o.includes("cloudfront")&&!o.includes("cdn"))},l=s=>s.split("?")[0].toLowerCase(),a=document.querySelectorAll([".photo-gallery",".vehicle-gallery",".gallery-main",".main-gallery",'[class*="gallery"]',".swiper-container",".carousel"].join(","));for(let s of a){let o=s.className?.toLowerCase()||"";if(o.includes("similar")||o.includes("recommend"))continue;let i=s.querySelectorAll("img");for(let g of i){let m=g.src||g.getAttribute("data-src")||g.getAttribute("data-lazy-src")||"";if(e(m)){let c=l(m);n.has(c)||(n.add(c),t.push(m))}}let u=s.querySelectorAll('[style*="background"]');for(let g of u){let c=(g.style.backgroundImage||"").match(/url\(['"]?([^'"]+)['"]?\)/);if(c&&c[1]){let d=c[1];if(e(d)){let h=l(d);n.has(h)||(n.add(h),t.push(d))}}}}if(t.length<5){let s=document.querySelectorAll("img");for(let o of s){let i=o.src||"";if(e(i)&&(o.width>200||o.height>200||!o.complete)){let u=l(i);n.has(u)||(n.add(u),t.push(i))}}}return t}function L(){let t=[],n=new Set,r=document.querySelectorAll("script:not([src])");for(let e of r){let l=e.textContent||"",a=/(https?:\/\/[^\s"']+\.(jpg|jpeg|png|webp))/gi,s;for(;(s=a.exec(l))!==null;){let o=s[1];if(o.length>50&&!o.includes("logo")&&!o.includes("icon")){let i=o.split("?")[0].toLowerCase();n.has(i)||(n.add(i),t.push(o))}}}return t}async function I(){await y(),await f(500),await b(),await f(300);let t=w(),n=L(),r=new Set,e=[];for(let l of[...t,...n]){let a=l.split("?")[0].toLowerCase();r.has(a)||(r.add(a),e.push(l))}return{images:e,totalFound:e.length,method:"lotview_page_extraction"}}chrome.runtime.onMessage.addListener((t,n,r)=>t.type==="PING"?(r({ok:!0}),!0):t.type!==p?!1:((async()=>{try{let e=await I();r({ok:!0,data:e})}catch(e){let l=e instanceof Error?e.message:"Image extraction failed";r({ok:!1,error:l})}})(),!0));})();
