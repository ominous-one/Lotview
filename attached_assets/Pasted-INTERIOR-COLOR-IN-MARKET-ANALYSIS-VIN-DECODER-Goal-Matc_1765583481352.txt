INTERIOR COLOR IN MARKET ANALYSIS & VIN DECODER

ğŸ¯ Goal

Match or exceed vAuto functionality by including Interior Color through the entire valuation workflow:
VIN decoding â†’ market comparables â†’ appraisal â†’ storage â†’ pricing decisions.

â¸»

âœ… 1.1 VIN Decoder Enhancement â€“ Add Interior Color

Requirements:
	â€¢	Modify VIN decoding pipeline to return:
	â€¢	interior_color
	â€¢	Normalize naming (e.g., â€œBlack Leatherâ€, â€œDark Greyâ€, â€œBeige Two-Toneâ€)
	â€¢	Add fallback rules when VIN API does not include interior color:
	â€¢	Use scraped listingâ€™s interior color
	â€¢	AI inference from photos (optional future upgrade)

UI Updates:
	â€¢	Display interior color inside VIN Decoder result panel:
	â€¢	Under trim/engine section
	â€¢	Use consistent styling with â€œExterior Colorâ€

â¸»

âœ… 1.2 Market Analysis Enhancement â€“ Add Interior Color Filters & Ranking

Requirements:
	â€¢	Include dealer-selected interior color when showing comparables
	â€¢	Show how each comparable differs:
	â€¢	Highlight matches in green (â€œMatching Interiorâ€)
	â€¢	Highlight mismatches in yellow (â€œDifferent Interiorâ€)

Analytics:
	â€¢	Add interior color as a comparable weighting factor:
	â€¢	Weighted scoring for identical interiors
	â€¢	Negative adjustment for mismatched interiors
	â€¢	Add interior color column to comparables table
	â€¢	Support sorting by interior color match percentage

â¸»

âœ… 1.3 Store Interior Color in Database

DB Schema Additions:
	â€¢	Add interior_color column to vehicles table
	â€¢	Add interior_color to appraisal records
	â€¢	Add interior_color to decoded VIN cache table (avoids re-decoding)

â¸»

â¸»

2. AUTOMATIC SAVING OF ALL APPRAISALS (FROM VIN DECODER / MARKET ANALYSIS)

ğŸ¯ Goal

Every valuation generated should be automatically stored and available for later review by management.

â¸»

âœ… 2.1 Auto-Create Appraisal Record When Market Analysis is Run

Trigger:
	â€¢	When user clicks:
	â€¢	â€œVIN Decoderâ€
	â€¢	â€œMarket Analysisâ€
	â€¢	â€œGet Appraisal Valueâ€

Stored Data:
	â€¢	VIN
	â€¢	Year, Make, Model, Trim
	â€¢	Mileage
	â€¢	Exterior + Interior Color
	â€¢	All comparable vehicles (snapshot JSON)
	â€¢	Appraisal value (min, max, recommended)
	â€¢	User who generated it
	â€¢	Dealership ID
	â€¢	Customer name/phone (if provided)

Appraisal naming:
	â€¢	Auto-generate appraisal name:
"{YEAR} {MAKE} {MODEL} - {CUSTOMER_NAME or LEAD ID}"

â¸»

âœ… 2.2 Add Saved Appraisals Dashboard Section

Location:
ğŸ”¹ Sales Manager menu
ğŸ”¹ â€œSaved Appraisalsâ€ page

Features:
	â€¢	Table view with filters:
	â€¢	VIN
	â€¢	Stock #
	â€¢	Date
	â€¢	User
	â€¢	Customer name
	â€¢	Click any record to:
	â€¢	See the entire market analysis snapshot
	â€¢	What we offered
	â€¢	Notes
	â€¢	Margin opportunities

Add â€œDeal Save Trackerâ€:
	â€¢	Dropdown:
	â€¢	â€œDeal Savedâ€
	â€¢	â€œLost Dealâ€
	â€¢	â€œPendingâ€
	â€¢	Notes field for reason
	â€¢	Manager-only editing permissions

â¸»

â¸»

3. FACEBOOK MESSENGER â†’ GOHIGHLEVEL TWO-WAY SYNC

ğŸ¯ Goal

All Messenger conversations flow into GHL as real conversations, not just leads.
This is critical to unify communication history and enable automated follow-up sequences.

â¸»

âš™ï¸ 3.1 Convert Messenger Conversations into GHL Conversations

Requirements:
For every inbound FB message:
	1.	Identify customer by FB ID
	2.	If not in GHL â†’ create new contact with:
	â€¢	Name
	â€¢	Phone (if provided later)
	â€¢	FB ID (custom field)
	â€¢	Lead source = Facebook Messenger
	3.	Create a GHL conversation with:
	â€¢	Message text
	â€¢	Proper timestamp
	â€¢	Read/unread status

â¸»

âš™ï¸ 3.2 Support Two-Way Sync (Reply from GHL or LotView)

Requirements:
	â€¢	When staff reply inside LotView â†’ push message into GHL thread
	â€¢	When staff reply inside GHL â†’ push message back into LotView
	â€¢	Maintain thread consistency

Technical requirements:
	â€¢	Webhook in LotView to receive GHL conversation updates
	â€¢	Message de-duplication ID system
	â€¢	Respect FB rate limits & GHL API limits

â¸»

âš™ï¸ 3.3 Sync Conversation metadata

Store:
	â€¢	Assigned sales rep
	â€¢	Tags
	â€¢	Status (new lead, hot, pending, sold)
	â€¢	Pipeline stage
	â€¢	Custom fields like â€œVehicle of Interestâ€

Business logic:
	â€¢	A FB Messenger convo should behave exactly like an SMS/email convo inside GHL.

â¸»

â¸»

4. VALIDATION, TESTING & QA REQUIREMENTS (MANDATORY)

âœ… Add automated tests for:
	â€¢	VIN decode â†’ appraisal auto-save
	â€¢	Interior color extraction scoring
	â€¢	GHL sync end-to-end
	â€¢	Facebook â†’ LotView â†’ GHL message flow

ğŸ” Add cross-tenant isolation tests:
	â€¢	No conversation/appraisal leaks between dealerships

â¸»

5. DEPLOYMENT REQUIREMENTS
	â€¢	All features must run on Replit
	â€¢	All DB schema updates must run via migration script
	â€¢	No breaking changes for existing dealerships
	â€¢	Create feature flags (ENABLE_APPRAISAL_AUTOSAVE, ENABLE_GHL_MESSENGER_SYNC) so rollout is controlled
