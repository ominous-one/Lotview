"use strict";(()=>{var{entries:Qt,setPrototypeOf:zt,isFrozen:Eo,getPrototypeOf:vo,getOwnPropertyDescriptor:xo}=Object,{freeze:Y,seal:J,create:ft}=Object,{apply:mt,construct:gt}=typeof Reflect<"u"&&Reflect;Y||(Y=function(e){return e});J||(J=function(e){return e});mt||(mt=function(e,i){for(var l=arguments.length,n=new Array(l>2?l-2:0),a=2;a<l;a++)n[a-2]=arguments[a];return e.apply(i,n)});gt||(gt=function(e){for(var i=arguments.length,l=new Array(i>1?i-1:0),n=1;n<i;n++)l[n-1]=arguments[n];return new e(...l)});var ze=j(Array.prototype.forEach),Ao=j(Array.prototype.lastIndexOf),Wt=j(Array.prototype.pop),Me=j(Array.prototype.push),Co=j(Array.prototype.splice),Ye=j(String.prototype.toLowerCase),at=j(String.prototype.toString),st=j(String.prototype.match),Ie=j(String.prototype.replace),ko=j(String.prototype.indexOf),So=j(String.prototype.trim),ee=j(Object.prototype.hasOwnProperty),W=j(RegExp.prototype.test),Ve=Mo(TypeError);function j(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var i=arguments.length,l=new Array(i>1?i-1:0),n=1;n<i;n++)l[n-1]=arguments[n];return mt(t,e,l)}}function Mo(t){return function(){for(var e=arguments.length,i=new Array(e),l=0;l<e;l++)i[l]=arguments[l];return gt(t,i)}}function A(t,e){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ye;zt&&zt(t,null);let l=e.length;for(;l--;){let n=e[l];if(typeof n=="string"){let a=i(n);a!==n&&(Eo(e)||(e[l]=a),n=a)}t[n]=!0}return t}function Io(t){for(let e=0;e<t.length;e++)ee(t,e)||(t[e]=null);return t}function ne(t){let e=ft(null);for(let[i,l]of Qt(t))ee(t,i)&&(Array.isArray(l)?e[i]=Io(l):l&&typeof l=="object"&&l.constructor===Object?e[i]=ne(l):e[i]=l);return e}function Re(t,e){for(;t!==null;){let l=xo(t,e);if(l){if(l.get)return j(l.get);if(typeof l.value=="function")return j(l.value)}t=vo(t)}function i(){return null}return i}var Yt=Y(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ct=Y(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ut=Y(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Vo=Y(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),dt=Y(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Ro=Y(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),jt=Y(["#text"]),Xt=Y(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),pt=Y(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Kt=Y(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),We=Y(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),_o=J(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Oo=J(/<%[\w\W]*|[\w\W]*%>/gm),Fo=J(/\$\{[\w\W]*/gm),No=J(/^data-[\-\w.\u00B7-\uFFFF]+$/),Do=J(/^aria-[\-\w]+$/),eo=J(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Po=J(/^(?:\w+script|data):/i),$o=J(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),to=J(/^html$/i),Ho=J(/^[a-z][.\w]*(-[.\w]+)+$/i),Zt=Object.freeze({__proto__:null,ARIA_ATTR:Do,ATTR_WHITESPACE:$o,CUSTOM_ELEMENT:Ho,DATA_ATTR:No,DOCTYPE_NAME:to,ERB_EXPR:Oo,IS_ALLOWED_URI:eo,IS_SCRIPT_OR_DATA:Po,MUSTACHE_EXPR:_o,TMPLIT_EXPR:Fo}),_e={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Bo=function(){return typeof window>"u"?null:window},Uo=function(e,i){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let l=null,n="data-tt-policy-suffix";i&&i.hasAttribute(n)&&(l=i.getAttribute(n));let a="dompurify"+(l?"#"+l:"");try{return e.createPolicy(a,{createHTML(f){return f},createScriptURL(f){return f}})}catch{return null}},Jt=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function oo(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Bo(),e=T=>oo(T);if(e.version="3.3.1",e.removed=[],!t||!t.document||t.document.nodeType!==_e.document||!t.Element)return e.isSupported=!1,e;let{document:i}=t,l=i,n=l.currentScript,{DocumentFragment:a,HTMLTemplateElement:f,Node:c,Element:E,NodeFilter:y,NamedNodeMap:C=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:k,DOMParser:I,trustedTypes:h}=t,V=E.prototype,M=Re(V,"cloneNode"),g=Re(V,"remove"),m=Re(V,"nextSibling"),s=Re(V,"childNodes"),L=Re(V,"parentNode");if(typeof f=="function"){let T=i.createElement("template");T.content&&T.content.ownerDocument&&(i=T.content.ownerDocument)}let p,b="",{implementation:v,createNodeIterator:D,createDocumentFragment:S,getElementsByTagName:z}=i,{importNode:Fe}=l,r=Jt();e.isSupported=typeof Qt=="function"&&typeof L=="function"&&v&&v.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:Ae,ERB_EXPR:K,TMPLIT_EXPR:Ne,DATA_ATTR:de,ARIA_ATTR:pe,IS_SCRIPT_OR_DATA:At,ATTR_WHITESPACE:Ke,CUSTOM_ELEMENT:De}=Zt,{IS_ALLOWED_URI:fe}=Zt,F=null,se=A({},[...Yt,...ct,...ut,...dt,...jt]),R=null,Z=A({},[...Xt,...pt,...Kt,...We]),x=Object.seal(ft(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),P=null,me=null,le=Object.seal(ft(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}})),Ce=!0,Q=!0,Ct=!1,kt=!0,Le=!1,Pe=!0,ge=!1,Ze=!1,Je=!1,we=!1,$e=!1,He=!1,St=!0,Mt=!1,mo="user-content-",Qe=!0,ke=!1,ye={},te=null,et=A({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),It=null,Vt=A({},["audio","video","img","source","image","track"]),tt=null,Rt=A({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Be="http://www.w3.org/1998/Math/MathML",Ue="http://www.w3.org/2000/svg",ie="http://www.w3.org/1999/xhtml",Te=ie,ot=!1,nt=null,go=A({},[Be,Ue,ie],at),Ge=A({},["mi","mo","mn","ms","mtext"]),qe=A({},["annotation-xml"]),ho=A({},["title","style","font","a","script"]),Se=null,bo=["application/xhtml+xml","text/html"],Lo="text/html",H=null,Ee=null,wo=i.createElement("form"),_t=function(o){return o instanceof RegExp||o instanceof Function},lt=function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Ee&&Ee===o)){if((!o||typeof o!="object")&&(o={}),o=ne(o),Se=bo.indexOf(o.PARSER_MEDIA_TYPE)===-1?Lo:o.PARSER_MEDIA_TYPE,H=Se==="application/xhtml+xml"?at:Ye,F=ee(o,"ALLOWED_TAGS")?A({},o.ALLOWED_TAGS,H):se,R=ee(o,"ALLOWED_ATTR")?A({},o.ALLOWED_ATTR,H):Z,nt=ee(o,"ALLOWED_NAMESPACES")?A({},o.ALLOWED_NAMESPACES,at):go,tt=ee(o,"ADD_URI_SAFE_ATTR")?A(ne(Rt),o.ADD_URI_SAFE_ATTR,H):Rt,It=ee(o,"ADD_DATA_URI_TAGS")?A(ne(Vt),o.ADD_DATA_URI_TAGS,H):Vt,te=ee(o,"FORBID_CONTENTS")?A({},o.FORBID_CONTENTS,H):et,P=ee(o,"FORBID_TAGS")?A({},o.FORBID_TAGS,H):ne({}),me=ee(o,"FORBID_ATTR")?A({},o.FORBID_ATTR,H):ne({}),ye=ee(o,"USE_PROFILES")?o.USE_PROFILES:!1,Ce=o.ALLOW_ARIA_ATTR!==!1,Q=o.ALLOW_DATA_ATTR!==!1,Ct=o.ALLOW_UNKNOWN_PROTOCOLS||!1,kt=o.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Le=o.SAFE_FOR_TEMPLATES||!1,Pe=o.SAFE_FOR_XML!==!1,ge=o.WHOLE_DOCUMENT||!1,we=o.RETURN_DOM||!1,$e=o.RETURN_DOM_FRAGMENT||!1,He=o.RETURN_TRUSTED_TYPE||!1,Je=o.FORCE_BODY||!1,St=o.SANITIZE_DOM!==!1,Mt=o.SANITIZE_NAMED_PROPS||!1,Qe=o.KEEP_CONTENT!==!1,ke=o.IN_PLACE||!1,fe=o.ALLOWED_URI_REGEXP||eo,Te=o.NAMESPACE||ie,Ge=o.MATHML_TEXT_INTEGRATION_POINTS||Ge,qe=o.HTML_INTEGRATION_POINTS||qe,x=o.CUSTOM_ELEMENT_HANDLING||{},o.CUSTOM_ELEMENT_HANDLING&&_t(o.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(x.tagNameCheck=o.CUSTOM_ELEMENT_HANDLING.tagNameCheck),o.CUSTOM_ELEMENT_HANDLING&&_t(o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(x.attributeNameCheck=o.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),o.CUSTOM_ELEMENT_HANDLING&&typeof o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(x.allowCustomizedBuiltInElements=o.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Le&&(Q=!1),$e&&(we=!0),ye&&(F=A({},jt),R=[],ye.html===!0&&(A(F,Yt),A(R,Xt)),ye.svg===!0&&(A(F,ct),A(R,pt),A(R,We)),ye.svgFilters===!0&&(A(F,ut),A(R,pt),A(R,We)),ye.mathMl===!0&&(A(F,dt),A(R,Kt),A(R,We))),o.ADD_TAGS&&(typeof o.ADD_TAGS=="function"?le.tagCheck=o.ADD_TAGS:(F===se&&(F=ne(F)),A(F,o.ADD_TAGS,H))),o.ADD_ATTR&&(typeof o.ADD_ATTR=="function"?le.attributeCheck=o.ADD_ATTR:(R===Z&&(R=ne(R)),A(R,o.ADD_ATTR,H))),o.ADD_URI_SAFE_ATTR&&A(tt,o.ADD_URI_SAFE_ATTR,H),o.FORBID_CONTENTS&&(te===et&&(te=ne(te)),A(te,o.FORBID_CONTENTS,H)),o.ADD_FORBID_CONTENTS&&(te===et&&(te=ne(te)),A(te,o.ADD_FORBID_CONTENTS,H)),Qe&&(F["#text"]=!0),ge&&A(F,["html","head","body"]),F.table&&(A(F,["tbody"]),delete P.tbody),o.TRUSTED_TYPES_POLICY){if(typeof o.TRUSTED_TYPES_POLICY.createHTML!="function")throw Ve('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof o.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Ve('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');p=o.TRUSTED_TYPES_POLICY,b=p.createHTML("")}else p===void 0&&(p=Uo(h,n)),p!==null&&typeof b=="string"&&(b=p.createHTML(""));Y&&Y(o),Ee=o}},Ot=A({},[...ct,...ut,...Vo]),Ft=A({},[...dt,...Ro]),yo=function(o){let d=L(o);(!d||!d.tagName)&&(d={namespaceURI:Te,tagName:"template"});let w=Ye(o.tagName),_=Ye(d.tagName);return nt[o.namespaceURI]?o.namespaceURI===Ue?d.namespaceURI===ie?w==="svg":d.namespaceURI===Be?w==="svg"&&(_==="annotation-xml"||Ge[_]):!!Ot[w]:o.namespaceURI===Be?d.namespaceURI===ie?w==="math":d.namespaceURI===Ue?w==="math"&&qe[_]:!!Ft[w]:o.namespaceURI===ie?d.namespaceURI===Ue&&!qe[_]||d.namespaceURI===Be&&!Ge[_]?!1:!Ft[w]&&(ho[w]||!Ot[w]):!!(Se==="application/xhtml+xml"&&nt[o.namespaceURI]):!1},oe=function(o){Me(e.removed,{element:o});try{L(o).removeChild(o)}catch{g(o)}},he=function(o,d){try{Me(e.removed,{attribute:d.getAttributeNode(o),from:d})}catch{Me(e.removed,{attribute:null,from:d})}if(d.removeAttribute(o),o==="is")if(we||$e)try{oe(d)}catch{}else try{d.setAttribute(o,"")}catch{}},Nt=function(o){let d=null,w=null;if(Je)o="<remove></remove>"+o;else{let $=st(o,/^[\r\n\t ]+/);w=$&&$[0]}Se==="application/xhtml+xml"&&Te===ie&&(o='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+o+"</body></html>");let _=p?p.createHTML(o):o;if(Te===ie)try{d=new I().parseFromString(_,Se)}catch{}if(!d||!d.documentElement){d=v.createDocument(Te,"template",null);try{d.documentElement.innerHTML=ot?b:_}catch{}}let G=d.body||d.documentElement;return o&&w&&G.insertBefore(i.createTextNode(w),G.childNodes[0]||null),Te===ie?z.call(d,ge?"html":"body")[0]:ge?d.documentElement:G},Dt=function(o){return D.call(o.ownerDocument||o,o,y.SHOW_ELEMENT|y.SHOW_COMMENT|y.SHOW_TEXT|y.SHOW_PROCESSING_INSTRUCTION|y.SHOW_CDATA_SECTION,null)},it=function(o){return o instanceof k&&(typeof o.nodeName!="string"||typeof o.textContent!="string"||typeof o.removeChild!="function"||!(o.attributes instanceof C)||typeof o.removeAttribute!="function"||typeof o.setAttribute!="function"||typeof o.namespaceURI!="string"||typeof o.insertBefore!="function"||typeof o.hasChildNodes!="function")},Pt=function(o){return typeof c=="function"&&o instanceof c};function re(T,o,d){ze(T,w=>{w.call(e,o,d,Ee)})}let $t=function(o){let d=null;if(re(r.beforeSanitizeElements,o,null),it(o))return oe(o),!0;let w=H(o.nodeName);if(re(r.uponSanitizeElement,o,{tagName:w,allowedTags:F}),Pe&&o.hasChildNodes()&&!Pt(o.firstElementChild)&&W(/<[/\w!]/g,o.innerHTML)&&W(/<[/\w!]/g,o.textContent)||o.nodeType===_e.progressingInstruction||Pe&&o.nodeType===_e.comment&&W(/<[/\w]/g,o.data))return oe(o),!0;if(!(le.tagCheck instanceof Function&&le.tagCheck(w))&&(!F[w]||P[w])){if(!P[w]&&Bt(w)&&(x.tagNameCheck instanceof RegExp&&W(x.tagNameCheck,w)||x.tagNameCheck instanceof Function&&x.tagNameCheck(w)))return!1;if(Qe&&!te[w]){let _=L(o)||o.parentNode,G=s(o)||o.childNodes;if(G&&_){let $=G.length;for(let X=$-1;X>=0;--X){let ae=M(G[X],!0);ae.__removalCount=(o.__removalCount||0)+1,_.insertBefore(ae,m(o))}}}return oe(o),!0}return o instanceof E&&!yo(o)||(w==="noscript"||w==="noembed"||w==="noframes")&&W(/<\/no(script|embed|frames)/i,o.innerHTML)?(oe(o),!0):(Le&&o.nodeType===_e.text&&(d=o.textContent,ze([Ae,K,Ne],_=>{d=Ie(d,_," ")}),o.textContent!==d&&(Me(e.removed,{element:o.cloneNode()}),o.textContent=d)),re(r.afterSanitizeElements,o,null),!1)},Ht=function(o,d,w){if(St&&(d==="id"||d==="name")&&(w in i||w in wo))return!1;if(!(Q&&!me[d]&&W(de,d))){if(!(Ce&&W(pe,d))){if(!(le.attributeCheck instanceof Function&&le.attributeCheck(d,o))){if(!R[d]||me[d]){if(!(Bt(o)&&(x.tagNameCheck instanceof RegExp&&W(x.tagNameCheck,o)||x.tagNameCheck instanceof Function&&x.tagNameCheck(o))&&(x.attributeNameCheck instanceof RegExp&&W(x.attributeNameCheck,d)||x.attributeNameCheck instanceof Function&&x.attributeNameCheck(d,o))||d==="is"&&x.allowCustomizedBuiltInElements&&(x.tagNameCheck instanceof RegExp&&W(x.tagNameCheck,w)||x.tagNameCheck instanceof Function&&x.tagNameCheck(w))))return!1}else if(!tt[d]){if(!W(fe,Ie(w,Ke,""))){if(!((d==="src"||d==="xlink:href"||d==="href")&&o!=="script"&&ko(w,"data:")===0&&It[o])){if(!(Ct&&!W(At,Ie(w,Ke,"")))){if(w)return!1}}}}}}}return!0},Bt=function(o){return o!=="annotation-xml"&&st(o,De)},Ut=function(o){re(r.beforeSanitizeAttributes,o,null);let{attributes:d}=o;if(!d||it(o))return;let w={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:R,forceKeepAttr:void 0},_=d.length;for(;_--;){let G=d[_],{name:$,namespaceURI:X,value:ae}=G,ve=H($),rt=ae,U=$==="value"?rt:So(rt);if(w.attrName=ve,w.attrValue=U,w.keepAttr=!0,w.forceKeepAttr=void 0,re(r.uponSanitizeAttribute,o,w),U=w.attrValue,Mt&&(ve==="id"||ve==="name")&&(he($,o),U=mo+U),Pe&&W(/((--!?|])>)|<\/(style|title|textarea)/i,U)){he($,o);continue}if(ve==="attributename"&&st(U,"href")){he($,o);continue}if(w.forceKeepAttr)continue;if(!w.keepAttr){he($,o);continue}if(!kt&&W(/\/>/i,U)){he($,o);continue}Le&&ze([Ae,K,Ne],qt=>{U=Ie(U,qt," ")});let Gt=H(o.nodeName);if(!Ht(Gt,ve,U)){he($,o);continue}if(p&&typeof h=="object"&&typeof h.getAttributeType=="function"&&!X)switch(h.getAttributeType(Gt,ve)){case"TrustedHTML":{U=p.createHTML(U);break}case"TrustedScriptURL":{U=p.createScriptURL(U);break}}if(U!==rt)try{X?o.setAttributeNS(X,$,U):o.setAttribute($,U),it(o)?oe(o):Wt(e.removed)}catch{he($,o)}}re(r.afterSanitizeAttributes,o,null)},To=function T(o){let d=null,w=Dt(o);for(re(r.beforeSanitizeShadowDOM,o,null);d=w.nextNode();)re(r.uponSanitizeShadowNode,d,null),$t(d),Ut(d),d.content instanceof a&&T(d.content);re(r.afterSanitizeShadowDOM,o,null)};return e.sanitize=function(T){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=null,w=null,_=null,G=null;if(ot=!T,ot&&(T="<!-->"),typeof T!="string"&&!Pt(T))if(typeof T.toString=="function"){if(T=T.toString(),typeof T!="string")throw Ve("dirty is not a string, aborting")}else throw Ve("toString is not a function");if(!e.isSupported)return T;if(Ze||lt(o),e.removed=[],typeof T=="string"&&(ke=!1),ke){if(T.nodeName){let ae=H(T.nodeName);if(!F[ae]||P[ae])throw Ve("root node is forbidden and cannot be sanitized in-place")}}else if(T instanceof c)d=Nt("<!---->"),w=d.ownerDocument.importNode(T,!0),w.nodeType===_e.element&&w.nodeName==="BODY"||w.nodeName==="HTML"?d=w:d.appendChild(w);else{if(!we&&!Le&&!ge&&T.indexOf("<")===-1)return p&&He?p.createHTML(T):T;if(d=Nt(T),!d)return we?null:He?b:""}d&&Je&&oe(d.firstChild);let $=Dt(ke?T:d);for(;_=$.nextNode();)$t(_),Ut(_),_.content instanceof a&&To(_.content);if(ke)return T;if(we){if($e)for(G=S.call(d.ownerDocument);d.firstChild;)G.appendChild(d.firstChild);else G=d;return(R.shadowroot||R.shadowrootmode)&&(G=Fe.call(l,G,!0)),G}let X=ge?d.outerHTML:d.innerHTML;return ge&&F["!doctype"]&&d.ownerDocument&&d.ownerDocument.doctype&&d.ownerDocument.doctype.name&&W(to,d.ownerDocument.doctype.name)&&(X="<!DOCTYPE "+d.ownerDocument.doctype.name+`>
`+X),Le&&ze([Ae,K,Ne],ae=>{X=Ie(X,ae," ")}),p&&He?p.createHTML(X):X},e.setConfig=function(){let T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};lt(T),Ze=!0},e.clearConfig=function(){Ee=null,Ze=!1},e.isValidAttribute=function(T,o,d){Ee||lt({});let w=H(T),_=H(o);return Ht(w,_,d)},e.addHook=function(T,o){typeof o=="function"&&Me(r[T],o)},e.removeHook=function(T,o){if(o!==void 0){let d=Ao(r[T],o);return d===-1?void 0:Co(r[T],d,1)[0]}return Wt(r[T])},e.removeHooks=function(T){r[T]=[]},e.removeAllHooks=function(){r=Jt()},e}var Go=oo();var qo={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function ht(t){return t.replace(/[&<>"'`=/]/g,e=>qo[e]||e)}function bt(t){let e={};for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let l=t[i];typeof l=="string"?e[i]=ht(l):typeof l=="number"||typeof l=="boolean"||l===null||l===void 0?e[i]=l:Array.isArray(l)?e[i]=l.map(n=>typeof n=="string"?ht(n):n):typeof l=="object"&&l!==null?e[i]=bt(l):e[i]=l}return e}function no(t){return ht(t).slice(0,500)}var zo="LV_FILL_FACEBOOK",Wo=15e3,so=300,N=400,O=800,q=1500,Yo=2e3,jo={title:{selectors:['input[name="title"]','input[data-testid="marketplace-create-title"]','input[aria-label*="Title" i]','input[placeholder*="Title" i]','input[aria-label*="What are you selling" i]'],ariaLabels:["Title","What are you selling","Item title","Listing title"],placeholders:["Title","What are you selling","Item title","Add a title"],nearbyTexts:["title","what are you selling","listing title"],testId:"marketplace-create-title"},price:{selectors:['input[name="price"]','input[data-testid="marketplace-create-price"]','input[type="text"][inputmode="numeric"]','input[aria-label*="Price" i]','input[inputmode="decimal"]'],ariaLabels:["Price","Enter your price","Set price"],placeholders:["Price","0","$0","Enter price"],nearbyTexts:["price","enter your price"],testId:"marketplace-create-price"},description:{selectors:['textarea[name="description"]','textarea[data-testid="marketplace-create-description"]','textarea[aria-label*="Description" i]','textarea[aria-label*="Seller" i]','textarea[placeholder*="Description" i]','[contenteditable="true"][aria-label*="Description" i]','[contenteditable="true"][aria-label*="Seller" i]','[contenteditable="true"][data-testid*="description" i]','div[role="textbox"][aria-label*="Description" i]','div[role="textbox"][aria-label*="Describe" i]','div[role="textbox"][aria-label*="Tell buyers" i]','div[role="textbox"][aria-label*="Seller" i]'],ariaLabels:["Description","Describe your item","Tell buyers","Seller description","Seller's description"],placeholders:["Description","Describe","Tell buyers","Seller description"],nearbyTexts:["description","describe","tell buyers","seller"],testId:"marketplace-create-description"},location:{selectors:['input[name="location"]','input[data-testid="marketplace-location"]','input[aria-label*="Location" i]','input[placeholder*="Location" i]','input[aria-label*="City" i]'],ariaLabels:["Location","Enter location","Set location","City"],placeholders:["Location","Enter location","City"],nearbyTexts:["location","city","where"],testId:"marketplace-location"},year:{selectors:['input[name="year"]','input[aria-label*="Year" i]','select[aria-label*="Year" i]','div[role="combobox"][aria-label*="Year" i]'],ariaLabels:["Year","Vehicle year","Model year"],placeholders:["Year","Select year"],nearbyTexts:["year"],testId:"marketplace-year"},make:{selectors:['input[name="make"]','input[aria-label*="Make" i]','select[aria-label*="Make" i]','div[role="combobox"][aria-label*="Make" i]'],ariaLabels:["Make","Vehicle make","Brand"],placeholders:["Make","Select make","Brand"],nearbyTexts:["make","brand"],testId:"marketplace-make"},model:{selectors:['input[name="model"]','input[aria-label*="Model" i]','select[aria-label*="Model" i]','div[role="combobox"][aria-label*="Model" i]'],ariaLabels:["Model","Vehicle model"],placeholders:["Model","Select model"],nearbyTexts:["model"],testId:"marketplace-model"}};function Xo(t){let e=t.toLowerCase().replace(/\s+/g," ").trim();return e==="mercedes benz"||e==="mercedes-benz"||e==="mercedes"?"Mercedes-Benz":e==="land rover"||e==="landrover"?"Land Rover":e==="alfa romeo"||e==="alfaromeo"?"Alfa Romeo":e==="aston martin"||e==="astonmartin"?"Aston Martin":e==="rolls royce"||e==="rolls-royce"||e==="rollsroyce"?"Rolls-Royce":e==="bmw"?"BMW":e==="gmc"?"GMC":e==="ram"?"RAM":e==="mini"?"MINI":e==="volkswagen"||e==="vw"?"Volkswagen":e==="chevrolet"||e==="chevy"?"Chevrolet":t.split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" ")}function u(t){return new Promise(e=>setTimeout(e,t))}function Ko(t,e){return t+Math.random()*(e-t)}var Zo=["Black","Blue","Brown","Gold","Gray","Green","Orange","Pink","Purple","Red","Silver","White","Yellow"],Lt={black:"Black",ebony:"Black",onyx:"Black",midnight:"Black",jet:"Black",obsidian:"Black",phantom:"Black",raven:"Black",noir:"Black",carbon:"Black",graphite:"Black",ink:"Black",cosmos:"Black",shadow:"Black",eclipse:"Black",white:"White",snow:"White",pearl:"White",ivory:"White",cream:"White",arctic:"White",polar:"White",frost:"White",glacier:"White",alpine:"White",crystal:"White",diamond:"White",lunar:"White",vanilla:"White",ceramic:"White",quartz:"White",chalk:"White",porcelain:"White",silver:"Silver",titanium:"Silver",platinum:"Silver",chrome:"Silver",steel:"Silver",gray:"Gray",grey:"Gray",charcoal:"Gray",slate:"Gray",stone:"Gray",ash:"Gray",pewter:"Gray",smoke:"Gray",cement:"Gray",concrete:"Gray",gunmetal:"Gray",iron:"Gray",lead:"Gray",tungsten:"Gray",magnetic:"Gray",blue:"Blue",azure:"Blue",navy:"Blue",cobalt:"Blue",sapphire:"Blue",ocean:"Blue",sea:"Blue",sky:"Blue",royal:"Blue",indigo:"Blue",denim:"Blue",pacific:"Blue",atlantic:"Blue",aegean:"Blue",teal:"Blue",turquoise:"Blue",aqua:"Blue",cyan:"Blue",marine:"Blue",nautical:"Blue",abyss:"Blue",twilight:"Blue","midnight blue":"Blue","electric blue":"Blue",red:"Red",crimson:"Red",scarlet:"Red",ruby:"Red",cherry:"Red",burgundy:"Red",maroon:"Red",wine:"Red",merlot:"Red",garnet:"Red",vermillion:"Red",cardinal:"Red",brick:"Red",rust:"Red",cayenne:"Red",chili:"Red",fire:"Red",flame:"Red",lava:"Red",candy:"Red",green:"Green",olive:"Green",emerald:"Green",forest:"Green",sage:"Green",moss:"Green",jade:"Green",lime:"Green",mint:"Green",hunter:"Green",pine:"Green",spruce:"Green",jungle:"Green",fern:"Green",army:"Green",khaki:"Green",military:"Green",camo:"Green",bamboo:"Green",brown:"Brown",tan:"Brown",beige:"Brown",bronze:"Brown",copper:"Brown",coffee:"Brown",mocha:"Brown",espresso:"Brown",chocolate:"Brown",caramel:"Brown",chestnut:"Brown",walnut:"Brown",mahogany:"Brown",hazel:"Brown",cocoa:"Brown",sand:"Brown",sandstone:"Brown",earth:"Brown",terra:"Brown",sienna:"Brown",umber:"Brown",sepia:"Brown",cognac:"Brown",saddle:"Brown",cinnamon:"Brown",gold:"Gold",golden:"Gold",champagne:"Gold",brass:"Gold",amber:"Gold",yellow:"Yellow",lemon:"Yellow",canary:"Yellow",sunshine:"Yellow",banana:"Yellow",mustard:"Yellow",sunflower:"Yellow",honey:"Yellow",blonde:"Yellow",orange:"Orange",tangerine:"Orange",peach:"Orange",coral:"Orange",apricot:"Orange",pumpkin:"Orange",papaya:"Orange",mango:"Orange",sunset:"Orange","copper orange":"Orange",purple:"Purple",violet:"Purple",plum:"Purple",lavender:"Purple",grape:"Purple",amethyst:"Purple",orchid:"Purple",lilac:"Purple",mauve:"Purple",magenta:"Purple",fuchsia:"Purple",berry:"Purple",eggplant:"Purple",aubergine:"Purple",pink:"Pink",rose:"Pink",blush:"Pink",salmon:"Pink",raspberry:"Pink",strawberry:"Pink",bubblegum:"Pink",flamingo:"Pink","hot pink":"Pink"};function lo(t){if(!t)return"Black";let e=t.toLowerCase().trim();for(let[l,n]of Object.entries(Lt))if(e.includes(l))return n;let i=e.split(/[\s\-_]+/);for(let l of i)if(Lt[l])return Lt[l];for(let l of Zo)if(e.startsWith(l.toLowerCase().slice(0,3)))return l;return"Gray"}function Jo(t){if(t===null||t===void 0)return"Gasoline";let e=String(t).toLowerCase().trim();if(!e)return"Gasoline";let i=e.replace(/[^a-z0-9]+/g," ");if(i.includes("electric")||i.includes("bev")||i.includes("battery")||i.split(" ").includes("ev"))return"Electric";if(i.includes("hybrid")||i.includes("phev")||i.includes("hev")||i.includes("plug-in")||i.includes("plugin"))return"Hybrid";if(i.includes("diesel")||i.includes("biodiesel")||i.includes("dsl"))return"Diesel";if(i.includes("flex")||i.includes("e85")||i.includes("ffv")||i.includes("ethanol"))return"Flex fuel";if(i.includes("gas")||i.includes("petrol")||i.includes("unleaded")||i.includes("regular")||i.includes("premium")||i.includes("super"))return"Gasoline";return"Gasoline"}function Qo(t){if(!t)return"Automatic";let e=t.toLowerCase().trim();return(e.includes("manual")||e.includes("stick")||e.includes("mt")||e.includes("standard")||e.includes("5-speed")||e.includes("6-speed")||e==="5spd"||e==="6spd")&&!e.includes("auto")?"Manual":"Automatic"}function xe(t,e){let i=document.querySelectorAll("span, label");for(let l of i)if(l.textContent?.trim().toLowerCase()===t.toLowerCase()){let a=l.parentElement;for(let f=0;f<6&&a;f++){if((a.textContent?.toLowerCase()||"").includes(e.toLowerCase()))return!0;a=a.parentElement}}return!1}function co(t,e){let i=Object.getOwnPropertyDescriptor(t.constructor.prototype,"value")?.set;i?i.call(t,e):t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))}function uo(t,e){if(t.focus(),t.getAttribute("contenteditable")==="true"||t.getAttribute("role")==="textbox"){let l=window.getSelection(),n=document.createRange();t.textContent="",n.selectNodeContents(t),n.collapse(!1),l?.removeAllRanges(),l?.addRange(n),document.execCommand("insertText",!1,e),t.textContent!==e&&(t.innerHTML=e.replace(/\n/g,"<br>"),t.dispatchEvent(new InputEvent("input",{bubbles:!0,inputType:"insertText",data:e}))),t.dispatchEvent(new Event("change",{bubbles:!0}))}else(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)&&(co(t,e),t.dispatchEvent(new KeyboardEvent("keydown",{bubbles:!0})),t.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0})))}function be(t){let e=t.getAttribute("role")?.toLowerCase()||"",i=t.getAttribute("type")?.toLowerCase()||"",l=t.getAttribute("aria-label")?.toLowerCase()||"",n=t.getAttribute("placeholder")?.toLowerCase()||"",a=t.getAttribute("name")?.toLowerCase()||"",f=t.className?.toLowerCase()||"";return!!(e==="searchbox"||e==="search"||i==="search"||l.includes("search")&&!l.includes("vehicle")||n.includes("search")||a.includes("search")||a.includes("query")||f.includes("search")||t.closest('[role="search"], [data-testid*="search"], form[action*="search"]')||t.closest('header, [role="banner"], [data-pagelet="FixedHeader"], nav, [data-pagelet*="header" i]'))}function wt(t){if(t.closest('header, [role="banner"], [data-pagelet="FixedHeader"], nav, [data-pagelet*="header" i]'))return!1;let i=t.querySelectorAll('input[inputmode="numeric"], input[inputmode="decimal"], input[type="number"]'),l=t.querySelectorAll('input[type="text"]:not([role="searchbox"]):not([aria-label*="search" i])'),n=t.querySelectorAll('textarea, [contenteditable="true"], div[role="textbox"]'),a=t.querySelectorAll('div[role="combobox"], select'),f=t.querySelectorAll('input[type="file"]'),c=(i.length>0?2:0)+(l.length>0?1:0)+(n.length>0?2:0)+(a.length>0?2:0)+(f.length>0?1:0),E=t.textContent?.toLowerCase()||"",y=0;return E.includes("price")&&y++,(E.includes("title")||E.includes("selling"))&&y++,E.includes("description")&&y++,(E.includes("photo")||E.includes("image"))&&y++,E.includes("location")&&y++,c>=3||c>=2&&y>=2}function en(){let t=['[aria-label*="Create" i][aria-label*="listing" i]','[aria-label*="Sell" i][aria-label*="vehicle" i]','[role="main"] [role="dialog"]','[data-pagelet*="create" i]','[role="main"] form','div[class*="marketplace"] form'];for(let l of t)try{let n=document.querySelector(l);if(n&&n.offsetParent!==null&&wt(n))return n}catch{continue}let e=document.querySelector('[role="main"]');if(e){let l=e.querySelectorAll("form");for(let n of l)if(n.offsetParent!==null&&wt(n))return n}let i=document.querySelectorAll("div");for(let l of i){let n=l.getBoundingClientRect();if(n.height>400&&n.width>200&&wt(l))return l}return null}function Oe(t,e){if(t.offsetParent===null||be(t)||e&&!e.contains(t))return!1;let i=t.getBoundingClientRect();return!(i.width<50||i.height<10)}var Xe=null;function ue(){return Xe||(Xe=en()),Xe}function po(){Xe=null}function tn(t){let e=ue(),i=e||document;for(let l of t)try{let n=i.querySelectorAll(l);for(let a of n)if(Oe(a,e))return a}catch{continue}return null}function on(t){let e=ue(),i=e||document;for(let l of t){let n=i.querySelectorAll(`input[aria-label*="${l}" i], textarea[aria-label*="${l}" i], [contenteditable="true"][aria-label*="${l}" i], div[role="textbox"][aria-label*="${l}" i]`);for(let a of n)if(Oe(a,e))return a}return null}function nn(t){let e=ue(),i=e||document;for(let l of t){let n=i.querySelectorAll(`input[placeholder*="${l}" i], textarea[placeholder*="${l}" i], [data-placeholder*="${l}" i]`);for(let a of n)if(Oe(a,e))return a}return null}function ln(t){let e=ue(),i=e||document;for(let l of t){let n=i.querySelectorAll("span, label, div");for(let a of n){let f=a.textContent?.trim().toLowerCase()||"";if(f===l.toLowerCase()||f.includes(l.toLowerCase())){let c=a.parentElement;for(let E=0;E<5&&c;E++){let y=c.querySelector("input:not([type='hidden']):not([type='file']), textarea, [contenteditable='true'], div[role='textbox']");if(y&&y!==a&&Oe(y,e))return y;c=c.parentElement}}}}return null}function rn(){let t=document.querySelector('[role="dialog"]')||document.querySelector("[data-pagelet]")||document.body;t&&t!==document.body&&(t.scrollTop=0,setTimeout(()=>{t.scrollTo({top:t.scrollHeight,behavior:"smooth"})},300))}function an(){document.querySelectorAll('input:not([type="hidden"]):not([type="file"]), textarea, [contenteditable="true"], div[role="textbox"]').forEach((e,i)=>{let l=e.tagName.toLowerCase(),n=e.getAttribute("aria-label")||"",a=e.getAttribute("placeholder")||"",f=e.getAttribute("name")||"",c=e.getAttribute("role")||"",E=e.offsetParent!==null})}function sn(t){let e=ue(),l=(e||document).querySelectorAll("input:not([type='hidden']):not([type='file']), textarea, [contenteditable='true'], div[role='textbox']");for(let n of l){if(!Oe(n,e))continue;let a=n.getAttribute("name")?.toLowerCase()||"",f=n.id?.toLowerCase()||"",c=n.className?.toLowerCase()||"",E=n.getAttribute("aria-label")?.toLowerCase()||"";if(a.includes(t)||f.includes(t)||c.includes(t)||E.includes(t))return n}return null}function yt(t,e){let i=tn(t.selectors);return i||(i=on(t.ariaLabels)),i||(i=nn(t.placeholders)),i||(i=ln(t.nearbyTexts)),!i&&e&&(i=sn(e)),i}async function cn(t,e){let i=Date.now();for(;Date.now()-i<Wo;){let l=yt(t,e);if(l)return l;await new Promise(n=>{let a=new MutationObserver(()=>{yt(t,e)&&(a.disconnect(),n())});a.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{a.disconnect(),n()},so)})}return yt(t,e)}async function io(t,e,i=3){let l=jo[t];if(!l)return!1;for(let n=0;n<i;n++){let a=await cn(l,t);if(!a){await u(q*(n+1));continue}uo(a,e),await u(N);let c=a.getAttribute("contenteditable")==="true"||a.getAttribute("role")==="textbox"?a.textContent||a.innerText||"":a.value;if(c===e||c.includes(e.substring(0,20)))return!0;await u(O)}return!1}var ro=50,un=10;function dn(t){try{let i=new URL(t).pathname.split("/").pop()||"image.jpg";return i.includes(".")?i:`${i}.jpg`}catch{return`image-${Date.now()}.jpg`}}async function pn(t,e){let i=c=>c?c.startsWith("image/"):!1,l=async c=>{try{let E=await fetch(c,{credentials:"omit",cache:"no-store"});if(!E.ok)return null;let y=E.headers.get("content-type");return i(y)?await E.blob():null}catch{return null}},n=async c=>{try{if(!chrome?.runtime?.sendMessage)return null;let E=await new Promise(y=>{try{chrome.runtime.sendMessage({type:"FETCH_IMAGE_BLOB",payload:{url:c},protocolVersion:1},v=>y(v))}catch{y(null)}});if(!E||!E.ok||!E.base64)return null;let y=Uint8Array.from(atob(E.base64),v=>v.charCodeAt(0));return new Blob([y],{type:E.contentType||"image/jpeg"})}catch{return null}};let o=new Set,s=[],add=c=>{if(c&&!o.has(c)){o.add(c),s.push(c)}};add(t);try{let c=new URL(t,location.href);c.search&&(c.search="",add(c.toString()));let r=c.pathname.replace(/(\.(?:jpe?g|png|webp))-\d{2,4}x\d{2,4}$/i,"$1").replace(/-\d{2,4}x\d{2,4}(?=\.(?:jpe?g|png|webp)$)/i,"");r!==c.pathname&&(c.pathname=r,add(c.toString()))}catch{t.includes("?")&&add(t.split("?")[0])}let a=null,m=t;for(let c of s){let f=!1;try{let r=new URL(c,location.href);f=r.origin===location.origin||r.protocol==="blob:"||r.protocol==="data:"}catch{f=c.startsWith("blob:")||c.startsWith("data:")}if(f)a=await l(c);if(!a)a=await n(c);if(!a&&e){let r=`${e}/api/public/image-proxy?url=${encodeURIComponent(c)}`;a=await n(r);if(!a&&f)a=await l(r)}if(a){m=c;break}}if(!a||a.size>un*1024*1024||a.size<25*1024){console.warn("[Lotview] Image fetch failed",{url:t,candidates:s.length,size:a?a.size:0});return null}let d=(a.type||"").toLowerCase();d==="image/jpg"&&(d="image/jpeg");let E=async c=>{let r=await c.slice(0,16).arrayBuffer();let b=new Uint8Array(r);if(b.length>=3&&b[0]===255&&b[1]===216&&b[2]===255)return"image/jpeg";if(b.length>=8&&b[0]===137&&b[1]===80&&b[2]===78&&b[3]===71&&b[4]===13&&b[5]===10&&b[6]===26&&b[7]===10)return"image/png";if(b.length>=4&&b[0]===71&&b[1]===73&&b[2]===70)return"image/gif";if(b.length>=12&&b[0]===82&&b[1]===73&&b[2]===70&&b[3]===70&&b[8]===87&&b[9]===69&&b[10]===66&&b[11]===80)return"image/webp";if(b.length>=4&&((b[0]===73&&b[1]===73&&b[2]===42&&b[3]===0)||(b[0]===77&&b[1]===77&&b[2]===0&&b[3]===42)))return"image/tiff";if(b.length>=12){let box=String.fromCharCode(b[4],b[5],b[6],b[7]);if(box==="ftyp"){let brand=String.fromCharCode(b[8],b[9],b[10],b[11]);if(brand==="heic"||brand==="heix"||brand==="hevc"||brand==="hevx")return"image/heic";if(brand==="heif"||brand==="mif1"||brand==="msf1")return"image/heif";if(brand==="avif")return"image/avif"}}return""};let y=["image/jpeg","image/png","image/gif","image/tiff","image/webp","image/heic","image/heif"];if(!y.includes(d)){let r=await E(a);r&&(d=r)}if(d==="image/avif"||!y.includes(d)){console.warn("[Lotview] Image type rejected",{url:m,type:d||a.type||""});return null}let r=dn(m);r=r.replace(/\.(?:jpe?g|png|gif|webp|tiff?|heic|heif)(?:-\d{2,4}x\d{2,4})?$/i,"");r||(r=`vehicle-${Date.now()}`);let ext=d==="image/jpeg"?"jpg":d==="image/png"?"png":d==="image/gif"?"gif":d==="image/webp"?"webp":d==="image/tiff"?"tiff":d==="image/heic"?"heic":"heif";let name=`${r}.${ext}`;return new File([a],name,{type:d})}var Tt=!1,Et=new Set,xt=new Set;async function fn(t,e=9){return new Promise((i,l)=>{let n=new Image;n.crossOrigin="anonymous",n.onload=()=>{try{let f=document.createElement("canvas"),c=f.getContext("2d");if(!c){i("");return}f.width=e,f.height=e-1,c.drawImage(n,0,0,e,e-1);let y=c.getImageData(0,0,e,e-1).data,C=[];for(let h=0;h<y.length;h+=4){let V=y[h]*.299+y[h+1]*.587+y[h+2]*.114;C.push(V)}let k="";for(let h=0;h<e-1;h++)for(let V=0;V<e-1;V++){let M=h*e+V;k+=C[M]>C[M+1]?"1":"0"}let I="";for(let h=0;h<k.length;h+=4){let V=k.substring(h,h+4);I+=parseInt(V,2).toString(16)}i(I)}catch{i("")}},n.onerror=()=>{i("")};let a=new FileReader;a.onload=()=>{n.src=a.result},a.onerror=()=>i(""),a.readAsDataURL(t)})}function mn(t,e){if(!t||!e||t.length!==e.length)return 999;let i=0;for(let l=0;l<t.length;l++){let n=parseInt(t[l],16),a=parseInt(e[l],16),f=n^a;for(;f>0;)i+=f&1,f>>=1}return i}function gn(t){if(!t)return!1;for(let e of xt)if(mn(t,e)<=5)return!0;return!1}async function hn(t){let e=await t.arrayBuffer(),i=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(i)).map(n=>n.toString(16).padStart(2,"0")).join("")}function bn(t){try{let e=new URL(t);return e.origin+e.pathname}catch{return t.split("?")[0].toLowerCase()}}function Ln(t){try{return bn(t).replace(/[-_]\d{2,4}x\d{2,4}/g,"").replace(/\/\d{2,4}x\d{2,4}\//g,"/").replace(/_(?:small|medium|large|thumb|thumbnail)/gi,"")}catch{return t}}async function ao(t,e){
if(Tt)return{success:!1,uploaded:0,skipped:t.length,method:"duplicate_blocked"};
Tt=!0,Et.clear(),xt.clear();
try{
let i=new Set,l=[];
for(let g of t){let m=Ln(g);i.has(m)||(i.add(m),l.push(g))}
let n=l.slice(0,ro),a=Math.max(0,l.length-ro),f=[];
for(let g of n){let m=await pn(g,e);if(!m)continue;let s=await hn(m);if(Et.has(s))continue;let L=await fn(m);if(!L)continue;if(L&&gn(L))continue;Et.add(s),L&&xt.add(L);let p=`vehicle-${Date.now()}-${f.length}-${m.name}`,b=new File([m],p,{type:m.type});f.push(b)}
if(f.length===0)return{success:!1,uploaded:0,skipped:t.length,method:"fetch_failed"};
let C=20,h=f.slice(0,C);
let k=()=>{let g=0,scope=ue()||document;let nodes=scope.querySelectorAll("span,div");for(let p of nodes){let txt=(p.textContent||"").replace(/\s+/g," ").trim();if(!txt)continue;let lower=txt.toLowerCase();if(lower.includes("photos")&&txt.includes("/")){let m=txt.match(/photos[^0-9]*(\d+)\s*\/\s*(\d+)/i);if(m)return parseInt(m[1],10)}}let m=scope.querySelectorAll("img[src^=\"blob:\"]");g+=m.length;let s=scope.querySelectorAll("div[style*=\"background-image\"]");for(let p of s)p.style.backgroundImage.includes("blob:")&&g++;let L=scope.querySelectorAll("img[src*='scontent'], img[src*='fbcdn'], img[src^='blob:']");for(let p of L){let b=p.getBoundingClientRect();b.top<900&&b.width>30&&b.height>30&&g++}let T=scope.querySelectorAll("[role=\"img\"][aria-label*='photo' i], [aria-label*='photo' i] img");for(let p of T){let b=p.getBoundingClientRect();b.width>30&&b.height>30&&g++}let R=scope.querySelectorAll("[aria-label*='remove' i][aria-label*='photo' i], [aria-label*='delete' i][aria-label*='photo' i]");R.length>g&&(g=R.length);return g};;
console.info("[Lotview] Uploading images",{total:t.length,selected:h.length});
window.scrollTo(0,0),await u(O);
let E=ue();
let y=async g=>new Promise(m=>{let s=!1;let L=new MutationObserver(()=>{let p=Array.from(document.querySelectorAll("input[type=\"file\"]"));if(p.length){s=!0;L.disconnect();m(p)}});L.observe(document.body,{childList:!0,subtree:!0});setTimeout(()=>{if(s)return;L.disconnect();m(Array.from(document.querySelectorAll("input[type=\"file\"]")))},g)});
let I=g=>{let m=(g.accept||"").toLowerCase(),s=0;return(m.includes("image")||m===""||m==="*/*")&&(s+=3),g.multiple&&(s+=2),g.offsetParent!==null&&(s+=1),E&&E.contains(g)&&(s+=2),(g.getBoundingClientRect().width>0&&g.getBoundingClientRect().height>0)&&(s+=1),s};
let h0=g=>{if(!g||g.length===0)return null;let m=g.filter(s=>{let L=(s.accept||"").toLowerCase();return L.includes("image")||L===""||L==="*/*"});m.length===0&&(m=g);m.sort((s,L)=>I(L)-I(s));return m[0]||null};
let r=async()=>{let g=["[data-testid*='photo']","[data-testid*='image']","[aria-label*='Add photo' i]","[aria-label*='Add photos' i]","[aria-label*='Add image' i]","[aria-label*='Upload photo' i]","[aria-label*='Upload image' i]","[aria-label*='drag and drop' i]","[role='button'][aria-label*='photo' i]","[role='button'][aria-label*='photos' i]","div[class*='photoUpload']","div[class*='photo-upload']","div[class*='imageUpload']"],m=!1;for(let s of g){if(m)break;let L=document.querySelectorAll(s);for(let p of L){let b=p.getBoundingClientRect();if(b.top>50&&b.top<500&&b.width>80&&b.height>40){p.click(),await u(q),m=!0;break}}}if(!m){let s=document.querySelectorAll("div, span, button, a");for(let L of s){let p=(L.textContent||"").trim().toLowerCase();if((p==="add photos"||p==="add photo"||p.includes("upload photo")||p.includes("drag and drop"))&&L.getBoundingClientRect().top<400){L.click(),await u(q),m=!0;break}}}};
let totalUploaded=0,method="file_input";let batchSize=10,batches=[];for(let bi=0;bi<h.length;bi+=batchSize)batches.push(h.slice(bi,bi+batchSize));for(let bi=0;bi<batches.length;bi++){let batch=batches[bi],attempt=0,batchUploaded=0;console.info("[Lotview] Upload batch",{batch:bi+1,total:batches.length,size:batch.length,uploaded:totalUploaded});for(;attempt<3&&batchUploaded===0;attempt++){bi>0&&await r();let g=Array.from(document.querySelectorAll("input[type='file']")),m=h0(g);if(!m){await r();g=await y(2000+attempt*500),m=h0(g)}if(m){let before=Math.max(totalUploaded,k());try{try{m.value=""}catch{}let L=new DataTransfer;batch.forEach(p=>L.items.add(p));let b=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"files")?.set;b?b.call(m,L.files):m.files=L.files,m.dispatchEvent(new Event("change",{bubbles:!0,composed:!0})),m.dispatchEvent(new Event("input",{bubbles:!0,composed:!0})),m.dispatchEvent(new CustomEvent("file-selected",{bubbles:!0,composed:!0,detail:{files:L.files}}));let v=Math.min(2500+batch.length*200,6e3);await u(v);let after=before,deadline=Date.now()+1e4;for(;Date.now()<deadline;){after=k();if(after>before)break;await u(400)}if(after>totalUploaded)totalUploaded=after;batchUploaded=Math.max(0,after-before);if(batchUploaded===0&&batch.length>0){batchUploaded=batch.length;totalUploaded=Math.min(h.length,totalUploaded+batchUploaded);method="file_input_unverified"}}catch{batchUploaded=0}if(batchUploaded>0){method=attempt>0?"file_input_retry":(batches.length>1?"file_input_batch":"file_input")}}}totalUploaded=Math.min(h.length,totalUploaded);if(totalUploaded>=h.length)break;await u(1500)}if(totalUploaded>0)return{success:!0,uploaded:Math.min(totalUploaded,h.length),skipped:a+(n.length-f.length),method};let s0=0;try{let g=document.querySelector("[aria-label*='Add photo' i], [aria-label*='drag' i], [data-testid*='photo']");if(g){g.focus(),await u(100);let m=new DataTransfer;h.forEach(b=>m.items.add(b));let s=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,composed:!0,clipboardData:m});let L=k();g.dispatchEvent(s),document.dispatchEvent(s),await u(3e3);s0=Math.max(0,k()-L)}}catch{}
if(s0>0)return{success:!0,uploaded:Math.min(s0,h.length),skipped:a+(n.length-f.length),method:"paste"};
let V=["[data-testid='photo-upload-zone']","[aria-label*='Add photo' i]","[aria-label*='Add photos' i]","[aria-label*='Add image' i]","[aria-label*='Upload image' i]","[aria-label*='drag and drop' i]","[role='button'][aria-label*='photo' i]","[role='button'][aria-label*='photos' i]","div[class*='photo']","[class*='upload']","[class*='media']"],M=null;for(let g of V)try{let m=document.querySelectorAll(g);for(let s of m){let L=s.getBoundingClientRect();if(L.top>50&&L.top<400&&L.width>60&&L.height>40){M=s;break}}if(M)break}catch{continue}
if(M)try{let g=new DataTransfer;h.forEach(p=>g.items.add(p)),Object.defineProperty(g,"dropEffect",{value:"copy",writable:!1}),Object.defineProperty(g,"effectAllowed",{value:"all",writable:!1});let m=p=>new DragEvent(p,{bubbles:!0,cancelable:!0,composed:!0,dataTransfer:g});let s=k();M.dispatchEvent(m("dragenter")),await u(100),M.dispatchEvent(m("dragover")),await u(100),M.dispatchEvent(m("dragover")),await u(50),M.dispatchEvent(m("drop")),M.dispatchEvent(m("dragleave")),await u(3e3);let L=Math.max(0,k()-s);if(L>0)return{success:!0,uploaded:Math.min(L,h.length),skipped:a+(n.length-f.length),method:"drag_drop"}}catch{}

try{let g=document.querySelector("input[placeholder*='title' i], input[placeholder*='year' i]")?.getAttribute("value")||"vehicle",m=await new Promise(s=>{chrome.runtime.sendMessage({type:"DOWNLOAD_IMAGES",payload:{imageUrls:t,vehicleInfo:g}},L=>s(L||{ok:!1,error:"No response"}))});if(m.ok&&m.downloadedCount)return vn(m.downloadedCount,m.folderName||"Lotview-Photos"),{success:!1,uploaded:0,skipped:t.length,method:"downloaded_for_manual"}}catch{}
return{success:!1,uploaded:0,skipped:t.length,method:"manual_required"}
}finally{Tt=!1}}async function wn(){let t=null,e=document.querySelectorAll("span, div");for(let n of e){let a=n.textContent?.trim();if(a==="Vehicle type"||a==="vehicle type"){let f=n.parentElement;for(let c=0;c<5&&f;c++){let E=f.getAttribute("tabindex"),y=f.getAttribute("role");if(E!==null||y==="button"||y==="combobox"||y==="listbox"){t=f;break}f=f.parentElement}if(t)break}}if(!t){let n=['[aria-label="Vehicle type"]','[aria-label*="Vehicle type"]','[aria-label*="vehicle type"]'];for(let a of n)if(t=document.querySelector(a),t)break}if(!t){let n=document.querySelectorAll('[role="combobox"]');for(let a of n){let f=a.getBoundingClientRect();if(f.top<80||f.width===0)continue;let c=a.textContent?.toLowerCase()||"";if(c.includes("vehicle")||c.includes("type")){t=a;break}}}if(!t)return!!document.querySelector('[aria-label*="Year" i], span:contains("Year")');t.scrollIntoView({behavior:"smooth",block:"center"}),await u(O),ce(t),await u(q);let i=0,l=null;for(;i<5&&!l;){let n=['[role="option"]','[role="menuitem"]','[role="menuitemradio"]'];for(let a of n){let f=document.querySelectorAll(a);for(let c of f){let E=c.textContent?.trim().toLowerCase()||"";if(E==="car/truck"||E.includes("car/truck")||E==="cars & trucks"){l=c;break}}if(l)break}if(!l){let a=document.querySelectorAll("span, div");for(let f of a)if(f.textContent?.trim().toLowerCase()==="car/truck"){l=f.closest('[role="option"], [role="menuitem"], [tabindex]')||f;break}}l||(await u(O),i++)}return l?(l.scrollIntoView({behavior:"smooth",block:"center"}),await u(N),ce(l),await u(Yo),!0):(ce(document.body),!1)}async function yn(t=5e3){let e=Date.now();for(;Date.now()-e<t;){po();let l=ue()||document;try{let a=l.querySelectorAll('div[aria-label*="Year" i], input[aria-label*="Year" i]'),f=l.querySelectorAll('div[aria-label*="Make" i], input[aria-label*="Make" i]');for(let c of a)if(c.offsetParent!==null&&!be(c))return!0;for(let c of f)if(c.offsetParent!==null&&!be(c))return!0}catch{}let n=l.querySelectorAll("span, label");for(let a of n){if(be(a))continue;let f=a.textContent?.trim().toLowerCase();if(f==="year"||f==="make"||f==="model")return!0}await u(so)}return!1}async function B(t,e){if(!e)return!1;let i=null,l=document.querySelectorAll("span, label");for(let C of l){let k=C.textContent?.trim();if(k===t||k?.toLowerCase()===t.toLowerCase()){let I=C.getBoundingClientRect();if(I.top<100||I.width===0)continue;let h=C.parentElement;for(let V=0;V<8&&h;V++){let M=h.getAttribute("role"),g=h.getAttribute("aria-haspopup"),m=h.getAttribute("tabindex");if(M==="combobox"||M==="listbox"||g==="listbox"){i=h;break}if(m!==null&&M!=="textbox"&&!h.querySelector('input[type="text"]')){i=h;break}h=h.parentElement}if(i)break}}if(!i){let C=document.querySelectorAll('[role="combobox"], [aria-haspopup="listbox"]');for(let k of C){let I=k.getAttribute("aria-label")?.toLowerCase()||"",h=k.textContent?.toLowerCase()||"";if((I.includes(t.toLowerCase())||h.includes(t.toLowerCase()))&&k.getBoundingClientRect().top>100){i=k;break}}}if(!i)return!1;i.scrollIntoView({behavior:"smooth",block:"center"}),await u(O),ce(i),await u(q);let n=i;async function a(C,k){let I=C.textContent?.trim()||"";C.scrollIntoView({behavior:"smooth",block:"center"}),await u(N);let h=document.querySelectorAll('[role="option"], [role="menuitem"]').length;C.click(),await u(O);let V=document.querySelectorAll('[role="option"], [role="menuitem"]').length,M=V<h/2||V<3,g=n.textContent?.toLowerCase()||"",m=g.includes(e.toLowerCase().slice(0,10))||g.includes(I.toLowerCase().slice(0,10));if(M||m)return!0;ce(C),await u(O);let s=document.querySelectorAll('[role="option"], [role="menuitem"]').length,L=s<h/2||s<3,p=n.textContent?.toLowerCase()||"",b=p.includes(e.toLowerCase().slice(0,8))||p.includes(I.toLowerCase().slice(0,8));return!!(L||b)}let f=3,c=0,E=-1,y=!1;for(;c<f;){let C=document.querySelectorAll('[role="option"], [role="menuitem"], [role="menuitemradio"]');if(C.length===0&&!y&&(y=!0,ce(document.body),await u(O),i&&(i.scrollIntoView({behavior:"smooth",block:"center"}),await u(N),ce(i),await u(q),C=document.querySelectorAll('[role="option"], [role="menuitem"], [role="menuitemradio"]'))),C.length===0&&y)break;E=C.length;for(let h of C)if((h.textContent?.trim()||"")===e&&await a(h,"exact match"))return!0;for(let h of C){let V=h.textContent?.trim()||"";if((V.toLowerCase()===e.toLowerCase()||V.toLowerCase().startsWith(e.toLowerCase())||V.toLowerCase().includes(e.toLowerCase()))&&await a(h,"partial match"))return!0}let k=e.split(" ")[0].toLowerCase();for(let h of C)if((h.textContent?.trim()||"").split(" ")[0].toLowerCase()===k&&await a(h,`first-word (${k})`))return!0;let I=document.querySelectorAll('div[tabindex="-1"], li, span[dir="auto"]');for(let h of I)if(h.textContent?.trim()===e&&h.offsetParent!==null){let M=h.getBoundingClientRect();if(M.top>150&&M.height>0&&M.height<60&&await a(h,"list item"))return!0}c++,await u(O)}return ce(document.body),await u(N),!1}async function vt(t,e){if(!e)return!1;function i(c,E){let y=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value")?.set;y?y.call(c,E):c.value=E}async function l(c,E){let y=c.value;c.focus(),await u(50),c.select(),await u(30),i(c,""),c.dispatchEvent(new Event("input",{bubbles:!0})),await u(50);for(let k of E)c.dispatchEvent(new KeyboardEvent("keydown",{key:k,code:`Key${k.toUpperCase()}`,bubbles:!0,cancelable:!0})),c.dispatchEvent(new KeyboardEvent("keypress",{key:k,bubbles:!0,cancelable:!0})),i(c,c.value+k),c.dispatchEvent(new InputEvent("input",{bubbles:!0,cancelable:!0,inputType:"insertText",data:k})),c.dispatchEvent(new KeyboardEvent("keyup",{key:k,bubbles:!0})),await u(20);return c.dispatchEvent(new Event("change",{bubbles:!0})),c.blur(),await u(50),c.value!==E?(i(c,E),c.dispatchEvent(new Event("input",{bubbles:!0})),c.dispatchEvent(new Event("change",{bubbles:!0})),await u(50),c.value===E):!0}let n=[],a=[document.querySelector('[role="dialog"]'),document.querySelector("form"),document.querySelector('[aria-label*="Create"]'),document.body].filter(Boolean);for(let c of a){let E=c.querySelectorAll("span, label");for(let y of E){let C=y.textContent?.trim();if(C!==t&&C?.toLowerCase()!==t.toLowerCase())continue;let k=y.getBoundingClientRect();if(k.top<100||k.width===0)continue;let I=y.parentElement;for(let h=0;h<6&&I;h++){let V=I.querySelectorAll('input[type="text"], input[type="tel"], input[type="number"], input:not([type])');for(let M of V){if(M.type==="hidden"||M.type==="file"||M.type==="checkbox"||!M.offsetParent)continue;let g=M.getBoundingClientRect();if(g.width<50||g.height<20)continue;let m=Math.abs(k.top-g.top)+Math.abs(k.left-g.left);n.some(s=>s.input===M)||n.push({input:M,label:y,distance:m})}I=I.parentElement}}if(n.length>0)break}n.sort((c,E)=>c.distance-E.distance);for(let{input:c,distance:E}of n)if(c.scrollIntoView({behavior:"smooth",block:"center"}),await u(N),await l(c,e))return await u(N),!0;let f=document.querySelector(`input[aria-label*="${t}" i]`);return f&&f.offsetParent!==null&&f.type!=="hidden"&&(f.scrollIntoView({behavior:"smooth",block:"center"}),await u(N),await l(f,e))?(await u(N),!0):!1}function ce(t){let e=t.getBoundingClientRect(),i=e.left+e.width/2,l=e.top+e.height/2,n={bubbles:!0,cancelable:!0,view:window,clientX:i,clientY:l,screenX:i,screenY:l};t.dispatchEvent(new MouseEvent("mousedown",n)),t.dispatchEvent(new MouseEvent("mouseup",n)),t.dispatchEvent(new MouseEvent("click",n))}function lvIsButtonVisible(t){if(!t||t.offsetParent===null)return!1;let e=t.getBoundingClientRect();return e.width>40&&e.height>20}function lvFindButton(t){let i=t.toLowerCase(),scopes=[ue(),document].filter(Boolean);for(let e of scopes){let l=Array.from(e.querySelectorAll('button,[role="button"],a[role="button"],div[role="button"],input[type="button"],input[type="submit"]'));for(let n of l){let a=(n.textContent||"").trim().toLowerCase(),f=(n.getAttribute("aria-label")||"").trim().toLowerCase(),c=(n.getAttribute("data-testid")||"").trim().toLowerCase(),d=(n.getAttribute("data-qa")||"").trim().toLowerCase();if((a===i||f===i||a.startsWith(i)||f.startsWith(i)||a.includes(i)||f.includes(i)||c.includes(i)||d.includes(i))&&lvIsButtonVisible(n))return n}}return null}async function lvClickButton(t,e=8e3){let i=Date.now(),l=!1;for(;;){let n=lvFindButton(t);if(n){if(n.getAttribute("aria-disabled")==="true"||n.disabled){await u(400);continue}return n.scrollIntoView({behavior:"smooth",block:"center"}),await u(100),ce(n),!0}if(!l){let a=ue();a&&a.scrollHeight>a.clientHeight&&(a.scrollTop=a.scrollHeight);window.scrollTo(0,document.body.scrollHeight),l=!0}if(Date.now()-i>e)break;await u(300)}return!1}async function lvAutoPublish(){let t=await lvClickButton("Next",2e4);t&&await u(2e3);let e=await lvClickButton("Publish",2e4);if(!e){await u(1500);e=await lvClickButton("Post",2e4)}return{nextClicked:t,publishClicked:e}}async function Tn(){let t=document.querySelectorAll("span, div, label");for(let i of t){let l=i.textContent?.toLowerCase()||"";if(l.includes("clean title")||l.includes("no significant damage")){let n=i.getBoundingClientRect();if(n.top<100||n.width===0)continue;let a=i.parentElement;for(let f=0;f<6&&a;f++){let c=a.querySelector('input[type="checkbox"]');if(c)return c.checked||(c.click(),await u(100)),!0;let E=a.querySelector('[role="checkbox"]');if(E)return E.getAttribute("aria-checked")==="true"||(E.click(),await u(100)),!0;a=a.parentElement}}}let e=document.querySelectorAll('input[type="checkbox"]');for(let i of e){let l=i.getBoundingClientRect();if(l.top>300&&l.top<1200&&!i.checked){let n=i.closest("label")?.textContent?.toLowerCase()||"",a=i.parentElement?.textContent?.toLowerCase()||"";if(n.includes("title")||a.includes("title")||n.includes("damage")||a.includes("damage"))return i.click(),await u(100),!0}}return!1}async function En(t){let{formData:e,imageUrls:i,proxyBaseUrl:l}=t,n=bt(e),a=[],f=[],c=[];po(),an(),rn(),await u(q);let E=ue();if(i&&i.length>0){window.scrollTo(0,0),await u(q);let g=!1,m=['[aria-label*="Add photo" i]','[aria-label*="Add photos" i]','[aria-label*="Add image" i]','[aria-label*="Upload photo" i]','[aria-label*="Upload image" i]','[aria-label*="drag and drop" i]','[aria-label*="photo" i][role="button"]','[role="button"][aria-label*="photos" i]','div[class*="photo"][role="button"]','div[class*="upload"][role="button"]','input[type="file"][accept*="image"]'];for(let L of m){if(g)break;let p=document.querySelectorAll(L);for(let b of p){let v=b.getBoundingClientRect();if(v.top>50&&v.top<400&&v.width>50){b.click(),await u(q),g=!0;break}}}if(!g){let L=document.querySelectorAll("div, span, button");for(let p of L){let b=p.textContent?.trim().toLowerCase()||"",v=p.getBoundingClientRect();if((b==="add photos"||b==="add photo"||b.includes("drag and drop"))&&v.top>50&&v.top<400){p.click(),await u(q),g=!0;break}}}let s=await ao(i,l);if(!s.success&&s.uploaded===0){await u(O);let L=document.querySelectorAll('[role="img"][aria-label*="photo" i], svg, [class*="photo"]');for(let p of L){let b=p.getBoundingClientRect();if(b.top>50&&b.top<400&&b.width>20){let v=p.closest('[role="button"], button, [tabindex]');if(v){v.click(),await u(q);break}}}s=await ao(i,l)}s.success?(a.push(`images (${s.uploaded} via ${s.method})`),s.skipped>0&&c.push(`${s.skipped} images skipped`)):c.push("Photos need to be added manually - click 'Add photos' above"),await u(q)}if(await wn()&&await yn(5e3)){let m=typeof e.title=="string"?e.title:String(e.title||""),s=n.year||m.match(/^(\d{4})/)?.[1]||"",L=n.make||m.split(" ")[1]||"",p=n.model||m.split(" ").slice(2).join(" ")||"",b=n.trim||"",v=b?`${p} ${b}`.trim():p;s&&(await B("Year",s)?a.push("year"):c.push("Year field not filled"),await u(O));let D=L?Xo(L):"",S=!1;if(L&&(S=await B("Make",D),!S&&D!==L&&(S=await B("Make",L)),S&&(await u(N),xe("Make",D)||xe("Make",L)||c.push("Make selection may not have worked - verify manually")),S?a.push("make"):c.push("Make field not filled"),await u(O)),v&&S){if(await u(q),await vt("Model",v))a.push("model");else{c.push("Model text input not filled");let P=document.querySelector('[role="dialog"], form, [aria-label*="Create"]');if(P){let me=P.querySelectorAll("span, label");for(let le of me)if(le.textContent?.trim().toLowerCase()==="model"){let Ce=le.closest("div[class]");if(Ce){let Q=Ce.querySelector("input");if(Q&&Q.type!=="file"&&Q.type!=="hidden"){Q.focus(),await u(100),Q.value=v,Q.dispatchEvent(new Event("input",{bubbles:!0})),Q.dispatchEvent(new Event("change",{bubbles:!0})),a.push("model (fallback)");break}}}}}await u(O)}else v&&!S&&c.push("Model skipped - Make selection failed");let z=n.odometer||"";z&&(await vt("Mileage",z)?a.push("mileage"):c.push("Mileage field not filled"),await u(O)),window.scrollBy(0,350),await u(q);let Fe=n.drivetrain||"",r=v.toLowerCase(),Ae=(D||n.make||"").toLowerCase(),K="Sedan";r.includes("gladiator")||r.includes("pickup")||r.includes("f-150")||r.includes("f150")||r.includes("silverado")||r.includes("sierra")||r.includes("ram")||r.includes("tacoma")||r.includes("tundra")||r.includes("frontier")||r.includes("colorado")||r.includes("ranger")||r.includes("ridgeline")||r.includes("titan")||r.includes("maverick")?K="Truck":r.includes("suv")||r.includes("crossover")||Ae.includes("jeep")||r.includes("wrangler")||r.includes("cherokee")||r.includes("compass")||r.includes("renegade")||r.includes("wagoneer")||r.includes("grand wagoneer")||r.includes("santa fe")||r.includes("tucson")||r.includes("kona")||r.includes("palisade")||r.includes("venue")||r.includes("ioniq 5")||r.includes("crosstrek")||r.includes("forester")||r.includes("outback")||r.includes("ascent")||r.includes("rav4")||r.includes("highlander")||r.includes("4runner")||r.includes("sequoia")||r.includes("land cruiser")||r.includes("venza")||r.includes("cr-v")||r.includes("hr-v")||r.includes("pilot")||r.includes("passport")||r.includes("rdx")||r.includes("mdx")||r.includes("zdx")||r.includes("explorer")||r.includes("escape")||r.includes("bronco")||r.includes("expedition")||r.includes("edge")||r.includes("equinox")||r.includes("traverse")||r.includes("blazer")||r.includes("tahoe")||r.includes("suburban")||r.includes("trailblazer")||r.includes("x1")||r.includes("x3")||r.includes("x5")||r.includes("x7")||r.includes("gle")||r.includes("glc")||r.includes("gls")||r.includes("glb")||r.includes("q3")||r.includes("q5")||r.includes("q7")||r.includes("q8")||r.includes("rx")||r.includes("nx")||r.includes("gx")||r.includes("lx")||r.includes("sportage")||r.includes("sorento")||r.includes("telluride")||r.includes("seltos")||r.includes("soul")||r.includes("niro")||r.includes("rogue")||r.includes("murano")||r.includes("pathfinder")||r.includes("armada")||r.includes("kicks")||r.includes("cx-")||Fe.toLowerCase().includes("awd")||Fe.toLowerCase().includes("4wd")?K="SUV":r.includes("coupe")||r.includes("gt")||r.includes("mustang")||r.includes("camaro")||r.includes("challenger")||r.includes("corvette")?K="Coupe":r.includes("convertible")||r.includes("roadster")||r.includes("cabriolet")||r.includes("spyder")?K="Convertible":r.includes("wagon")||r.includes("estate")||r.includes("avant")||r.includes("allroad")?K="Wagon":r.includes("van")||r.includes("minivan")||r.includes("sienna")||r.includes("odyssey")||r.includes("pacifica")||r.includes("carnival")||r.includes("transit")||r.includes("sprinter")?K="Van":(r.includes("hatchback")||r.includes("5-door")||r.includes("golf")||r.includes("civic hatch"))&&(K="Hatchback"),await B("Body style",K)?a.push("bodyStyle"):c.push("Body style field not filled"),await u(O);let de=n.exteriorColor||"";if(de){let x=lo(de),P=await B("Exterior color",x);P&&(await u(N),xe("Exterior color",x)||(P=await B("Exterior color",x))),!P&&x!==de&&(P=await B("Exterior color",de)),P?a.push("exteriorColor"):c.push(`Exterior color "${de}" not filled (tried "${x}")`),await u(O)}let pe=n.interiorColor||"Black";if(pe){let x=lo(pe),P=await B("Interior color",x);P&&(await u(N),xe("Interior color",x)||(P=await B("Interior color",x))),!P&&x!==pe&&(P=await B("Interior color",pe)),P?a.push("interiorColor"):c.push(`Interior color "${pe}" not filled (tried "${x}")`),await u(O)}await Tn()?a.push("cleanTitle"):c.push("Clean title checkbox not checked"),await u(N),await B("Vehicle condition","Excellent")?a.push("vehicleCondition"):c.push("Vehicle condition field not filled"),await u(O);let De=n.fuelType||n.fuel_type||n.fuel||"";let fe=Jo(De);console.info("[Lotview] Fuel type",{raw:De,normalized:fe});let F=await B("Fuel type",fe);F&&(await u(N),xe("Fuel type",fe)||(F=await B("Fuel type",fe))),F?a.push("fuelType"):c.push(`Fuel type "${De}" not filled (tried "${fe}")`),await u(O);let se=n.transmission||"",R=Qo(se),Z=await B("Transmission",R);!Z&&R==="Automatic"&&(Z=await B("Transmission","Automatic transmission")),!Z&&R==="Manual"&&(Z=await B("Transmission","Manual transmission")),Z&&(await u(N),xe("Transmission",R)||(Z=await B("Transmission",R))),!Z&&se&&R!==se&&(Z=await B("Transmission",se)),Z?a.push("transmission"):c.push(`Transmission "${se||"none"}" not filled (tried "${R}")`),await u(O)}let C=!1;if(a.includes("year")||a.includes("make")||a.includes("model"))C=!0;else{let g=typeof n.title=="string"?n.title:"";if(C=await io("title",g),!C){let L=(ue()||document).querySelectorAll('input:not([type="hidden"]):not([type="file"]):not([type="checkbox"]):not([type="radio"])');for(let p of L)if(!be(p)&&p.offsetParent!==null&&!p.value&&p.type==="text"){let v=(p.closest('[role="dialog"]')||p.closest("form")||p.parentElement)?.textContent?.toLowerCase()||"";if((v.includes("title")||v.includes("selling"))&&(uo(p,g),await u(100),p.value.includes(g.substring(0,10)))){C=!0;break}}}C?a.push("title"):f.push("title")}if(await u(O),window.scrollBy(0,400),await u(q),n.price!==null&&n.price!==void 0&&n.price!==""){let g=String(n.price).replace(/[^0-9]/g,""),m=!1,s=null,L=['input[name="price"]','input[data-testid="marketplace-create-price"]','input[type="text"][inputmode="numeric"]','input[aria-label*="Price" i]','input[inputmode="decimal"]'];for(let p of L){let b=document.querySelector(p);if(b&&b.offsetParent!==null){s=b;break}}if(!s){let p=document.querySelectorAll("input");for(let b of p){if(b.type==="hidden"||b.type==="file"||b.type==="checkbox"||b.type==="radio"||!b.offsetParent)continue;let v=b.parentElement;for(let D=0;D<6&&v;D++){let S=v.textContent?.toLowerCase()||"";if((S.includes("price")||S.includes("$"))&&!S.includes("mileage")&&!S.includes("odometer")&&!S.includes("year")&&!S.includes("location")&&!S.includes("search")){s=b;break}v=v.parentElement}if(s)break}}if(!s&&!m&&(m=await vt("Price",g)),!s&&!m){let p=document.querySelectorAll("span, label, div");for(let b of p)if((b.textContent?.trim()||"")==="Price"){let D=b.parentElement;for(let S=0;S<6&&D&&!s;S++){let z=D.querySelector('input:not([type="hidden"]):not([type="file"]):not([type="checkbox"]):not([type="radio"])');if(z&&z.offsetParent!==null){s=z;break}D=D.parentElement}if(s)break}}if(!s&&!m){let p=document.querySelectorAll('input[placeholder="Price"], input[placeholder="price"], input[placeholder*="price" i]');for(let b of p)if(b.offsetParent!==null&&b.type!=="hidden"){s=b;break}}if(!s&&!m){let p=Array.from(document.querySelectorAll("span, label, div")).filter(b=>b.textContent?.trim()==="Price"&&b.getBoundingClientRect().width>20);if(p.length>0){let v=p[0].getBoundingClientRect(),D=Array.from(document.querySelectorAll("input")).filter(S=>{if(!S.offsetParent||S.type==="hidden"||S.type==="file"||S.type==="checkbox")return!1;let z=S.getBoundingClientRect();return z.top>=v.top&&z.top<=v.top+150&&z.width>60});for(let S of D){let z=S.getAttribute("inputmode")?.toLowerCase()||"";if(z==="numeric"||z==="decimal"){s=S;break}}if(!s&&D.length>0){let S=D[0];(!S.value||S.placeholder?.toLowerCase().includes("price"))&&(s=S)}}}if(s&&!m)if(s.scrollIntoView({behavior:"smooth",block:"center"}),await u(N),s.focus(),await u(100),s.value="",s.dispatchEvent(new Event("input",{bubbles:!0})),await u(50),co(s,g),s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})),await u(N),s.value===g||s.value.includes(g))m=!0;else{s.value="",s.dispatchEvent(new Event("input",{bubbles:!0})),await u(50);for(let p of g)s.value+=p,s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new InputEvent("input",{bubbles:!0,data:p,inputType:"insertText"})),await u(30);s.dispatchEvent(new Event("change",{bubbles:!0})),await u(N),(s.value===g||s.value.includes(g))&&(m=!0)}m?a.push("price"):f.push("price"),await u(O)}window.scrollBy(0,300),await u(q);let I=typeof n.description=="string"?n.description:"",h=!1;if(I){let g=document.querySelectorAll("span, label");for(let m of g){let s=m.textContent?.trim();if(s==="Description"||s?.toLowerCase()==="description"){let L=m.getBoundingClientRect();if(L.top<100||L.width===0)continue;let p=m.parentElement;for(let b=0;b<8&&p;b++){let v=p.querySelector('textarea, div[role="textbox"], [contenteditable="true"]');if(v&&v.offsetParent!==null){v.scrollIntoView({behavior:"smooth",block:"center"}),await u(100),v.focus(),await u(100),v.tagName==="TEXTAREA"?(v.value=I,v.dispatchEvent(new Event("input",{bubbles:!0}))):(v.textContent=I,v.dispatchEvent(new Event("input",{bubbles:!0}))),await u(200),h=!0;break}p=p.parentElement}if(h)break}}if(h||(h=await io("description",I)),!h){let m=document.querySelectorAll('textarea, div[role="textbox"], [contenteditable="true"]');for(let s of m){let L=s.getBoundingClientRect();if(L.top<100||L.width===0||be(s))continue;let p=s.getAttribute("aria-label")?.toLowerCase()||"",b=s.getAttribute("placeholder")?.toLowerCase()||"",v=s.parentElement?.textContent?.toLowerCase().slice(0,100)||"";if(p.includes("description")||b.includes("description")||p.includes("seller")||v.includes("description")){s.focus(),await u(100),s.tagName==="TEXTAREA"?s.value=I:s.textContent=I,s.dispatchEvent(new Event("input",{bubbles:!0})),await u(100),h=!0;break}}}if(!h){window.scrollBy(0,300),await u(O);let m=document.querySelectorAll('textarea, div[role="textbox"], [contenteditable="true"]');for(let s of m){let L=s.getBoundingClientRect();if(!(L.height<40||L.width<200||L.top<100||L.top>900||be(s)||(s.tagName==="TEXTAREA"?s.value:s.textContent||"").length>20)){s.scrollIntoView({behavior:"smooth",block:"center"}),await u(N),s.focus(),await u(N),s.getAttribute("contenteditable")==="true"||s.getAttribute("role")==="textbox"?document.execCommand("insertText",!1,I):s.tagName==="TEXTAREA"&&(s.value=I),s.dispatchEvent(new Event("input",{bubbles:!0})),s.dispatchEvent(new Event("change",{bubbles:!0})),await u(N),h=!0;break}}}}h?a.push("description"):c.push("Description field not filled"),await u(Ko(300,500)),a.push("location (pre-populated)");let qn=["title","price"].filter(g=>f.includes(g)).length===0;let hn=a.some(g=>typeof g=="string"&&g.startsWith("images"));let hasNext=!!lvFindButton("Next");let canAuto=hn||hasNext;canAuto&&console.info("[Lotview] Auto publish",{ready:qn,images:hn,hasNext});if(canAuto){let g=await lvAutoPublish();g.nextClicked||c.push("Next button not clicked");g.publishClicked||c.push("Publish button not clicked");g.publishClicked&&a.push("publish")}else qn&&!canAuto&&c.push("Auto publish skipped - images not uploaded");return{success:qn,filledFields:a,missingFields:f,warnings:c}}function vn(t,e){let i=document.getElementById("lv-photo-instructions");i&&i.remove();let l=document.createElement("div");l.id="lv-photo-instructions",l.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border-radius: 12px;
    padding: 24px 32px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    z-index: 999999;
    max-width: 450px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    text-align: center;
  `,l.innerHTML=`
    <div style="font-size: 48px; margin-bottom: 12px;">\u{1F4F8}</div>
    <h3 style="margin: 0 0 12px 0; color: #1a1a1a; font-size: 18px;">Photos Downloaded!</h3>
    <p style="margin: 0 0 16px 0; color: #666; font-size: 14px; line-height: 1.5;">
      <strong>${t} photos</strong> have been saved to your<br>
      <strong>Downloads/${e}</strong> folder
    </p>
    <div style="background: #f0f7ff; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
      <p style="margin: 0; color: #1a73e8; font-size: 14px; font-weight: 500;">
        To add photos:
      </p>
      <ol style="margin: 8px 0 0 0; padding-left: 20px; text-align: left; color: #333; font-size: 13px;">
        <li style="margin-bottom: 4px;">Open your Downloads folder</li>
        <li style="margin-bottom: 4px;">Find the <strong>${e}</strong> folder</li>
        <li style="margin-bottom: 4px;">Select all photos (Ctrl+A or Cmd+A)</li>
        <li>Drag them to the photo area above</li>
      </ol>
    </div>
    <button id="lv-photo-instructions-close" style="
      background: #1a73e8;
      color: white;
      border: none;
      padding: 10px 24px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    ">Got it</button>
  `,document.body.appendChild(l),document.getElementById("lv-photo-instructions-close")?.addEventListener("click",()=>{l.remove()}),setTimeout(()=>l.remove(),3e4)}function je(t,e){let i=document.getElementById("lv-notification");i&&i.remove();let l=no(t),n=document.createElement("div");n.id="lv-notification",n.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 16px 24px;
    border-radius: 8px;
    color: white;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    z-index: 999999;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    max-width: 350px;
    background: ${e==="success"?"#22c55e":e==="error"?"#ef4444":"#3b82f6"};
  `,n.textContent=l,document.body.appendChild(n),setTimeout(()=>n.remove(),6e3)}function fo(){let t=document.getElementById("lv-notification");t&&t.remove()}window.addEventListener("beforeunload",fo);document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&fo()});chrome.runtime.onMessage.addListener((t,e,i)=>t.type==="PING"?(i({ok:!0}),!0):t.type!==zo?!1:((async()=>{try{je("Filling form...","info");let l=t.payload,n=await En(l);if(!n.success){let f=`Form fill failed: Could not find ${n.missingFields.join(", ")} field(s). Facebook may have changed their page layout.`;je(f,"error"),i({ok:!1,error:f,details:n});return}let a=`Form filled! Completed: ${n.filledFields.join(", ")}.`;n.warnings.length>0&&(a+=` Note: ${n.warnings.join("; ")}`),a+=" Auto-advance to Publish attempted; verify before finalizing.",je(a,"success"),i({ok:!0,details:n})}catch(l){let n=l instanceof Error?l.message:"Fill failed";je(`Error: ${n}`,"error"),i({ok:!1,error:n})}})(),!0));})();
/*! Bundled license information:

dompurify/dist/purify.es.mjs:
  (*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE *)
*/
